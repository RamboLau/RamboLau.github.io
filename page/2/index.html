<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.useso.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Drupal linux unix vim" />





  <link rel="alternate" href="/atom.xml" title="云端知识笔记" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="记录生活，分享知识，传播乐趣">
<meta property="og:type" content="website">
<meta property="og:title" content="云端知识笔记">
<meta property="og:url" content="http://verynull.com/page/2/index.html">
<meta property="og:site_name" content="云端知识笔记">
<meta property="og:description" content="记录生活，分享知识，传播乐趣">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="云端知识笔记">
<meta name="twitter:description" content="记录生活，分享知识，传播乐趣">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> 云端知识笔记 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">云端知识笔记</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">记录生活，分享知识，传播乐趣</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/31/Drupal8-Configuration-Schema/" itemprop="url">
                  drupal8 configuration schema
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-10-31T16:39:15+08:00" content="2016-10-31">
              2016-10-31
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Drupal8/" itemprop="url" rel="index">
                    <span itemprop="name">Drupal8</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/31/Drupal8-Configuration-Schema/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/31/Drupal8-Configuration-Schema/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Drupal 8中configuration schema是用来描述配置文件的结构的. 它应用于:<br>定型配置以确保数据一致性<br>(see StorableConfigBase::castValue())</p>
<p>自动持久化实体属性的配置<br> (see ConfigEntityBase::toArray())</p>
<p>自动生成用户界面的翻译配置<br> (see the core module)</p>
<p>1、一个简单的示例<br>如下:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">config/install/my_module.settings.yml</div><div class="line">type: warning</div><div class="line">message: <span class="string">'Hello!'</span></div><div class="line">langcode: en</div><div class="line"></div><div class="line">config/schema/my_module.schema.yml</div><div class="line">my_module.settings:</div><div class="line">  type: config_object</div><div class="line">  mapping:</div><div class="line">    type:</div><div class="line">	  type: string</div><div class="line">	  label: <span class="string">'Message type'</span></div><div class="line">	message:</div><div class="line">	  type: label</div><div class="line">	  label: <span class="string">'Message text'</span></div><div class="line">	langcode:</div><div class="line">	  type: string</div><div class="line">	  label: <span class="string">'Language code'</span></div></pre></td></tr></table></figure></p>
<p>需要说明的是，my_module.schema.yml我们可以认为是一个自定义的数据结构体，而my_module.settings.yml则是给这个自定义的数据结构体定义了默认值，<br>在my_module.schema.yml中我们可以看到这个数据结构体中定义了一个mapping结构体(可以简单的认为是一个数组类型)，这个数组有三个key，分别是type、message、langcode，<br>前面说了my_module.settings.yml是给my_module.schema.yml这个数据结构体定义了默认值，我们可以看到在my_module.settings.yml中type的默认值是warning,message的默认值<br>是’Hello!’,langcode的默认值是en,值的注意的一点是，一个schema.yml文件可以定义多个数据结构体，但是每一个的数据结构体的root元素必须与settings.yml文件的文件名一致，<br>比如上面的两个文件settings.yml文件的文件名是my_module.settings.yml，my_module.schema.yml的root元素的名称就是my_module.settings。</p>
<p>2、schema中常用的数据类型<br>基本类型：<br>boolean，<br>integer，<br>float，<br>string，<br>uri，<br>email</p>
<p>列表类型：<br>mapping(知道key是什么)，<br>sequence(不知道key的具体值)</p>
<p>常见的子类型：<br>label: 短标签<br>text: 长文本<br>config_object: object根元素类型<br>config_entity: entity根元素类型</p>
<p>子类型化<br>所有configuration schema的子类型都是从现有的类型演化而来.<br>早些时候的简单示例子类型config_object (mapping的一个子类型) 可以进一步自定义key。<br>configuration schema根节点的数据类型一般都是config_object或者config_entity。</p>
<p>3、关于动态类型[%parent]<br>确切的数据类型可能不会知道，而且还有类型取决于数据的可能性，configuration schema同样支持基于数据的类型。假设Message的类型可能取决于数据的类型：无论Message是一个列表<br>或者是一个简单的警告。让我们用 ‘multiple’ 来定义列表情况,用 ‘warning’ 来表示一个单行的警告。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">config/install/my_module.message.single.yml</div><div class="line">type: warning</div><div class="line">message: <span class="string">'Hello!'</span></div><div class="line">langcode: en</div><div class="line"></div><div class="line">config/install/my_module.message.multiple.yml</div><div class="line">type: multiple</div><div class="line">message:</div><div class="line"> -<span class="string">'Hello!'</span></div><div class="line"> -<span class="string">'Hi!'</span> </div><div class="line">langcode: en</div><div class="line"></div><div class="line">config/schema/my_module.schema.yml</div><div class="line">my_module.message.*:</div><div class="line"> type: config_object </div><div class="line"> mapping:</div><div class="line">  type:</div><div class="line">   type: string</div><div class="line">   label: <span class="string">'Message type'</span></div><div class="line">  message:</div><div class="line">   type: my_module_message.[%<span class="keyword">parent</span>.type]</div><div class="line"> langcode:	</div><div class="line">   type: string</div><div class="line">   label: <span class="string">'Language code'</span></div><div class="line"></div><div class="line">my_module_message.warning:</div><div class="line"> type: string</div><div class="line"></div><div class="line">my_module_message.multiple:</div><div class="line"> type: sequence</div><div class="line"> label: <span class="string">'Messages'</span></div><div class="line"> sequence:</div><div class="line">  type: string</div><div class="line">  label: <span class="string">'Message'</span></div></pre></td></tr></table></figure></p>
<p>首先看my_module.schema.yml这个文件，’my_module.message.*’用了通配符定义结构体，所以它适用于一组配置名称。所以我们看到分别有my_module.message.single.yml跟my_module.message.multiple.yml<br>这两个配置文件。接着往下看my_module.schema.yml，’type: my_module_message.[%parent.type]’ message的类型用了动态元素[%parent.type]来定义，所以在下面我们看到了my_module_message.warning跟<br>my_module_message.multiple两个类型定义，无论是my_module_message.warning还是my_module_message.multiple的前缀都是跟my_module_message.[%parent.type]的前缀一致的，另外需要注意的是内部节点的<br>名称要避免与根节点相同以免造成冲突。</p>
<p>4、关于动态类型 [type]<br>如果想要在已有的数据下面定义你自己不同的数据类型 那么[type]将会变的非常有用.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">config/install/my_module.message.single.yml</div><div class="line"> message: </div><div class="line">  type: warning</div><div class="line">  value: <span class="string">'Hello!'</span></div><div class="line"> langcode: en</div><div class="line"> </div><div class="line">config/install/my_module.message.multiple.yml</div><div class="line"> message:</div><div class="line">  type: multiple </div><div class="line">  value:</div><div class="line">   -<span class="string">'Hello!'</span></div><div class="line">   -<span class="string">'Hi!'</span></div><div class="line"> langcode: en</div><div class="line"></div><div class="line">config/schema/my_module.schema.yml</div><div class="line">my_module.message.*:</div><div class="line"> type: config_object</div><div class="line"> mapping:</div><div class="line">  message:</div><div class="line">   type: my_module_message.[type]</div><div class="line">  […]</div><div class="line">  </div><div class="line">my_module_message.warning:</div><div class="line"> type: mapping</div><div class="line"> […]</div><div class="line"> </div><div class="line">my_module_message.multiple:</div><div class="line"> type: mapping</div><div class="line"> […]</div></pre></td></tr></table></figure></p>
<p>首先看my_module.schema.yml文件用[type]来动态定义message的类型，所以my_module.schema.yml这个文件中我们又看到了my_module_message.warning跟my_module_message.multiple这两个定义类型，<br>需要说明的是无论是my_module_message.warning还是my_module_message.multiple它们的类型都是mapping类型，那么它们对应的值也必须mapping类型，我们再来看my_module.message.single.yml跟<br>my_module.message.multiple.yml两个文件，message的值也是mapping类型。<br>你同样可以定义一个包含相同的key，例如’type’的 基础类型,并且继承这个基础的类型你可以扩展任何自定义类型的key。</p>
<p>5、关于动态类型[%key]</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">config/install/my_module.messages.yml</div><div class="line">messages: </div><div class="line"> <span class="string">'single:1'</span>: <span class="string">'Hello!'</span></div><div class="line"> <span class="string">'single:2'</span>: <span class="string">'Hi!'</span></div><div class="line"> <span class="string">'multiple:1'</span>:</div><div class="line">  -<span class="string">'Good morning!'</span></div><div class="line">  -<span class="string">'Good night!'</span></div><div class="line">langcode: en</div></pre></td></tr></table></figure>
<p>这是一个任意消息元素的列表.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">config/schema/my_module.schema.yml</div><div class="line"> my_module.messages:</div><div class="line">  type: config_object</div><div class="line">  mapping:		</div><div class="line">   messages:</div><div class="line">    type: sequence</div><div class="line">    label:<span class="string">'Messages'</span>				</div><div class="line">    sequence:				</div><div class="line">     type: my_module_message.[%key] </div><div class="line">   langcode:</div><div class="line">    type: string</div><div class="line">    label: <span class="string">'Language code'</span></div><div class="line"> </div><div class="line"> my_module_message.single:*:</div><div class="line">  type: string</div><div class="line">  label: <span class="string">'Message'</span></div><div class="line"></div><div class="line"> my_module_message.multiple:*:</div><div class="line">  type: sequence</div><div class="line">  label: <span class="string">'Messages'</span></div><div class="line">  sequence:</div><div class="line">   type: string</div><div class="line">   label: <span class="string">'Message'</span></div></pre></td></tr></table></figure></p>
<p>首先看config/schema/my_module.schema.yml，messages的类型是sequence，而sequence的类型则是以my_module_message为前缀的动态类型，再往下看定义了my_module_message.single:<em>:跟<br>my_module_message.multiple:</em>:两个结构类型，这两个类型对应的messages值分别是以’single:<em>‘跟’multiple:</em>‘为前缀的，所以我们在config/install/my_module.messages.yml这个文件中<br>看到了’single:<em>‘跟’multiple:</em>‘为前缀的的messages的默认值</p>

            
          </span>
        
      
    </div>
    
    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/24/windows下安装配置drupalconsole/" itemprop="url">
                  windows下安装配置drupalconsole
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-10-24T17:38:17+08:00" content="2016-10-24">
              2016-10-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/drupal/" itemprop="url" rel="index">
                    <span itemprop="name">drupal</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/24/windows下安装配置drupalconsole/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/24/windows下安装配置drupalconsole/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h3 id="drupalconsole是啥"><a href="#drupalconsole是啥" class="headerlink" title="drupalconsole是啥"></a>drupalconsole是啥</h3><blockquote>
<p>The new CLI for Drupal. A tool to generate boilerplate code, interact with and debug Drupal.</p>
</blockquote>
<p>以上是官网的简介，总而言之是为drupal8而生的一个命令行工具</p>
<p><a href="https://drupalconsole.com/" target="_blank" rel="external">这里是官网</a></p>
<h3 id="drupalconsole在windows下的安装"><a href="#drupalconsole在windows下的安装" class="headerlink" title="drupalconsole在windows下的安装"></a>drupalconsole在windows下的安装</h3><p>本篇仅介绍在windows下的安装配置，linux请参见官网</p>
<p>1、下载<code>drupalconsole</code></p>
<p><a href="https://drupalconsole.com/installer" target="_blank" rel="external">点击这里</a>下载<code>drupalconsole</code>，更名<code>drupal</code></p>
<p>2、找个目录给他安顿</p>
<p>例如：<code>D:\system\drupalconsole</code>，如下图所示：</p>
<p><img src="https://static.verycloud.cn/sites/default/files/images/drupalconsole_home.png" alt="drupalconsole家目录"></p>
<p>3、配置环境变量</p>
<p>把<code>php.exe</code>所在的目录加入环境变量<code>PATH</code>中</p>
<p>再把上一步<code>drupalconsole</code>的安顿目录加入<code>windows</code>的环境变量<code>PATH</code>中，用户或者系统的都可以</p>
<p>如下图：</p>
<p><img src="https://static.verycloud.cn/sites/default/files/images/system_path.png" alt="drupalconsole家目录"></p>
<p>4、打开<code>git</code>的命令行工具测试一下</p>
<p><img src="https://static.verycloud.cn/sites/default/files/images/drupalconsole.png" alt="drupalconsole测试"></p>
<blockquote>
<p>再插一句，貌似windows不认识非exe的可执行程序，需要安装个git的命令行工具</p>
</blockquote>

            
          </span>
        
      
    </div>
    
    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/07/web开发规范/" itemprop="url">
                  web开发规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-10-07T21:55:39+08:00" content="2016-10-07">
              2016-10-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/07/web开发规范/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/07/web开发规范/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <h2 id="文件编码"><a href="#文件编码" class="headerlink" title="文件编码"></a>文件编码</h2><p>前端开发涉及的所文件统一使用<code>utf-8</code>编码</p>
<h2 id="文件命名规则"><a href="#文件命名规则" class="headerlink" title="文件命名规则"></a>文件命名规则</h2><p>全部小写方式，以下划线分隔</p>
<p>例：my_project</p>
<blockquote>
<p>特例：drupal中的模版文件</p>
</blockquote>
<h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ul>
<li>缩进使用2个空格；</li>
<li>嵌套的节点应该缩进；</li>
<li>在属性上，使用双引号，不要使用单引号；</li>
<li>属性名全小写，用中划线做分隔符；</li>
<li>不要在自动闭合标签结尾处使用斜线（<a href="http://dev.w3.org/html5/spec-author-view/syntax.html#syntax-start-tag">HTML5 规范</a> 指出他们是可选的）；</li>
<li>不要忽略可选的关闭标签，例：<code>&lt;/li&gt;</code> 和 <code>&lt;/body&gt;</code>。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Page title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/company_logo.png"</span> <span class="attr">alt</span>=<span class="string">"Company"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"hello-world"</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/10/07/web开发规范/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>
    
    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/22/infinidb与clickhouse对比/" itemprop="url">
                  infiniDB与clickhouse对比
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-08-22T13:55:37+08:00" content="2016-08-22">
              2016-08-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/22/infinidb与clickhouse对比/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/22/infinidb与clickhouse对比/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>机器配置：</p>
<p>测试机：    dell R510<br>cpu：     xeon E5620<em>2<br>RAID卡：    H700<br>系统    ：ubuntu 14.04<br>内核：    Linux ubuntu 4.2.0-27-generic<br>raid级别：    raid0<br>文件系统：    ext4<br>硬盘：     SSD 240G</em>2<br>IP：    192.168.112.73</p>
<p>一、安装<br>1、infiniDB的安装见 <a href="http://verynull.com/2015/06/24/infiniDB安装配置/">http://verynull.com/2015/06/24/infiniDB安装配置/</a></p>
<p>2、clickhouse安装<br>只支持ubutu14.04,16.04，12.04，但是我在16.04上没有安装起来。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv E0C56BD4<span class="comment"># optional</span></div><div class="line"></div><div class="line">sudo mkdir -p /etc/apt/sources.list.d</div><div class="line"><span class="built_in">echo</span> <span class="string">"deb http://repo.yandex.ru/clickhouse/trusty stable main"</span> |</div><div class="line">sudo tee /etc/apt/sources.list.d/clickhouse.list</div><div class="line">sudo apt-get update</div><div class="line"></div><div class="line">sudo apt-get install clickhouse-server-common clickhouse-client</div><div class="line"></div><div class="line">sudo service clickhouse-server start</div><div class="line">clickhouse-client</div></pre></td></tr></table></figure></p>
<p>3、就安装过程而言，clickhouse方便很多，infiniDB要编译老半天。</p>
<p>二、性能测试</p>
<p>1、创建表</p>
<p>infiniDB:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `billing` (</div><div class="line">`did` int(11) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">`hit` bigint(20) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">`reqs` bigint(20) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">`rx` bigint(20) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">`tx` bigint(20) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">`logtime` bigint(20) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">`tpr` bigint(20) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">''</span></div><div class="line">) ENGINE=infiniDB DEFAULT CHARSET=latin1</div></pre></td></tr></table></figure></p>
<p>clickhouse:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE billing (id Int32,did Int32,hit Int64,reqs Int64,rx Int64,tx Int64,logtime Int64,tpr Int64) ENGINE=Log;</div></pre></td></tr></table></figure></p>
<p>2、导入csv数据</p>
<p>csv格式如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">106,9,10,123,11858014,1467133200,330,0</div><div class="line">122,0,2,506,621,1467133200,150,0</div><div class="line">124,112,249,1131297,1899996,1467133200,49,0</div><div class="line">127,3,12,64257,88503,1467133200,66,0</div></pre></td></tr></table></figure></p>
<p>数据量9000万,大小4.5G。</p>
<p>infiniDB:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo /data/mysql/bin/mysql --defaults-file=/data/mysql/my.cnf --local-infile -u root monitor <span class="_">-e</span> <span class="string">"load data local infile '/root/1.txt' into table billing FIELDS TERMINATED BY ',';"</span></div></pre></td></tr></table></figure></p>
<p>耗时：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">0.60user </div><div class="line">2.50system </div><div class="line">4:14.61elapsed 1%CPU (0avgtext+0avgdata 3640maxresident)k</div><div class="line">0inputs+0outputs (0major+227minor)pagefaults 0swaps</div></pre></td></tr></table></figure></p>
<p>clickhouse:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat 1.txt | clickhouse-client --query=<span class="string">"INSERT INTO monitor.monitor_data FORMAT CSV"</span>;</div></pre></td></tr></table></figure></p>
<p>耗时：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">real1m6.809s</div><div class="line">user1m26.720s</div><div class="line">sys 0m6.724s</div></pre></td></tr></table></figure></p>
<p>clickhouse导入速度明显快很多。</p>
<p>3、查询速度</p>
<p>SQL:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SELECT logtime, SUM(hit) as hit, SUM(reqs) as reqs, SUM(rx) as rx,SUM(tx) as tx, round(avg(tpr)) as tpr FROM billingWHERE did &gt; 0AND logtime &gt;= 1467302400 AND logtime &lt;= 1469980799 GROUP BY logtime ORDER BY l</div><div class="line">ogtime;</div></pre></td></tr></table></figure></p>
<p>infiniDB:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">9663 rows <span class="keyword">in</span> <span class="built_in">set</span> (1.26 sec)</div></pre></td></tr></table></figure></p>
<p>clickhouse:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">8924 rows <span class="keyword">in</span> set. Elapsed: 2.676 sec. Processed 91.80 million rows, 4.77 GB (34.30 million rows/s., 1.78 GB/s.)</div></pre></td></tr></table></figure></p>
<p>infiniDB速度较快。</p>
<p>4、2亿数据对比</p>
<p>SQL同上</p>
<p>infiniDB:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">9663 rows <span class="keyword">in</span> <span class="built_in">set</span> (2.24 sec)</div></pre></td></tr></table></figure></p>
<p>clickhouse:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">8924 rows <span class="keyword">in</span> set. Elapsed: 4.215 sec. Processed 183.61 million rows, 9.55 GB (43.56 million rows/s., 2.26 GB/s.)</div></pre></td></tr></table></figure></p>
<p>infiniDB较快。</p>
<p>5、10亿数据对比</p>
<p>SQL同上</p>
<p>infiniDB:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">9663 rows <span class="keyword">in</span> <span class="built_in">set</span> (9.58 sec)</div></pre></td></tr></table></figure></p>
<p>clickhouse:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">8924 rows <span class="keyword">in</span> set. Elapsed: 17.040 sec. Processed 1.01 billion rows, 52.51 GB (56.67 million rows/s., 2.95 GB/s.)</div></pre></td></tr></table></figure></p>
<p>infiniDB更快。</p>
<p>6、count对比<br>infiniDB:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">+------------+</div><div class="line">| count(*) |</div><div class="line">+------------+</div><div class="line">| 1009844583 |</div><div class="line">+------------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (6.14 sec)</div></pre></td></tr></table></figure></p>
<p>clickhouse:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">SELECT count(*)</div><div class="line">FROM billing </div><div class="line"></div><div class="line">┌────count()─┐</div><div class="line">│ 1009844583 │</div><div class="line">└────────────┘</div><div class="line"></div><div class="line">1 rows <span class="keyword">in</span> set. Elapsed: 1.120 sec. Processed 1.01 billion rows, 4.04 GB (901.82 million rows/s., 3.61 GB/s.)</div></pre></td></tr></table></figure></p>
<p>7、压缩比<br>infiniDB:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">22G billing</div></pre></td></tr></table></figure></p>
<p>clickhouse:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">24G billing</div></pre></td></tr></table></figure></p>
<p>压缩比相差不多。</p>
<p>结果：<br>1、infiniDB会使用所有CPU，而clickhouse最多使用10个。<br>2、clickhouse在大数据量的时候，处理速度还是比较令人满意的。<br>3、clickhouse在导入数据的时候，查询会被卡住，而infiniDB不会。<br>4、infiniDB性能更好。</p>
<p>附对比图：<br>这里clickhouse是Log引擎。<br><img src="https://static.verycloud.cn/sites/default/files/pic/image/20160822/20160822222132_99553.png" alt="对比图"></p>
<hr>
<p>经一位俄罗斯网友提醒,MergeTree引擎比Log引擎更高效，因为Log引擎会全表扫描，而MergeTree的结构是这样的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">xxxx@ubuntu:/opt/clickhouse$ ls data/monitor/billing_mergetree</div><div class="line">20150829_20150831_10964_10994_2</div><div class="line">20160101_20160131_10_11360_30 </div><div class="line">20160401_20160430_12_9964_31</div><div class="line">20160609_20160613_11302_11350_4</div><div class="line">20160808_20160820_10972_11250_2</div><div class="line">20150325_20150331_4_9822_23 </div><div class="line">20150901_20150930_1030_11316_50</div><div class="line">20160201_20160229_244_10606_27</div><div class="line">20160401_20160430_9982_11362_10 </div><div class="line">20160701_20160731_308_8668_14 </div><div class="line">20160820_20160820_11260_11260_0</div><div class="line">20150401_20150430_16_9932_57</div><div class="line">20151001_20151031_8_11352_39 </div><div class="line">20160220_20160229_10618_10788_10</div><div class="line">20160501_20160531_530_11042_23</div><div class="line">20160701_20160731_8678_10786_12</div><div class="line">20160820_20160820_11266_11266_0</div><div class="line">20150501_20150531_102_10032_75</div><div class="line">20151009_20151011_11356_11356_0</div><div class="line">20160229_20160229_10804_10812_1 </div><div class="line">20160528_20160531_11056_11124_6 </div><div class="line">20160731_20160731_10798_10798_0</div><div class="line">detached</div></pre></td></tr></table></figure>
<p>这种存储结构就是把每个月的数据单独放置在一个文件夹中，这样就避免了全表扫描。</p>
<p>附对比图:<br><img src="https://static.verycloud.cn/sites/default/files/pic/image/20160823/20160823113203_30109.png" alt="对比图"></p>
<p>结论：<br>clickhouse速度更快！</p>

            
          </span>
        
      
    </div>
    
    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/20/Drupal8数据库-database/" itemprop="url">
                  Drupal8数据库(database)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-07-20T22:20:15+08:00" content="2016-07-20">
              2016-07-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Drupal8/" itemprop="url" rel="index">
                    <span itemprop="name">Drupal8</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/20/Drupal8数据库-database/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/20/Drupal8数据库-database/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Drupal8的数据库操作函数跟Drupal7没什么变化，但是，在Drupal9(还没开始开发，但是代码注释中已经有)中会把一些函数移除，比如db_add, db_insert, db_query等，见 <a href="https://api.drupal.org/api/drupal/core%21includes%21database.inc/8" title="D8 database" target="_blank" rel="external">Drupal8 database</a>。</p>
<p>##Select</p>
<p>###Get single value:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$query = \Drupal::database()-&gt;select(<span class="string">'node_field_data'</span>, <span class="string">'nfd'</span>);</div><div class="line">$query-&gt;addField(<span class="string">'nfd'</span>, <span class="string">'nid'</span>);</div><div class="line">$query-&gt;condition(<span class="string">'nfd.title'</span>, <span class="string">'Potato'</span>);</div><div class="line">$query-&gt;range(<span class="number">0</span>, <span class="number">1</span>);</div><div class="line">$nid = $query-&gt;execute()-&gt;fetchField();</div></pre></td></tr></table></figure>
<p>###Get single row:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$query = \Drupal::database()-&gt;select(<span class="string">'node_field_data'</span>, <span class="string">'nfd'</span>);</div><div class="line">$query-&gt;fields(<span class="string">'nfd'</span>, [<span class="string">'nid'</span>, <span class="string">'title'</span>]);</div><div class="line">$query-&gt;condition(<span class="string">'nfd.type'</span>, <span class="string">'vegetable'</span>);</div><div class="line">$query-&gt;range(<span class="number">0</span>, <span class="number">1</span>);</div><div class="line">$vegetable = $query-&gt;execute()-&gt;fetchAssoc();</div></pre></td></tr></table></figure>
<p>###Using db like:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$query = \Drupal::database()-&gt;select(<span class="string">'node_field_data'</span>, <span class="string">'nfd'</span>);</div><div class="line">$query-&gt;fields(<span class="string">'nfd'</span>, [<span class="string">'nid'</span>, <span class="string">'title'</span>]);</div><div class="line">$query-&gt;condition(<span class="string">'nfd.type'</span>, <span class="string">'vegetable'</span>);</div><div class="line">$query-&gt;condition(<span class="string">'nfd.title'</span>, $query-&gt;escapeLike(<span class="string">'ca'</span>) . <span class="string">'%'</span>, <span class="string">'LIKE'</span>);</div><div class="line">$vegetable = $query-&gt;execute()-&gt;fetchAllKeyed();</div></pre></td></tr></table></figure>
<p>###Get several rows with JOIN:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$query = \Drupal::database()-&gt;select(<span class="string">'node_field_data'</span>, <span class="string">'nfd'</span>);</div><div class="line">$query-&gt;fields(<span class="string">'nfd'</span>, [<span class="string">'nid'</span>, <span class="string">'title'</span>]);</div><div class="line">$query-&gt;addField(<span class="string">'ufd'</span>, <span class="string">'name'</span>);</div><div class="line">$query-&gt;join(<span class="string">'users_field_data'</span>, <span class="string">'ufd'</span>, <span class="string">'ufd.uid = nfd.uid'</span>);</div><div class="line">$query-&gt;condition(<span class="string">'nfd.type'</span>, <span class="string">'vegetable'</span>);</div><div class="line">$vegetable = $query-&gt;execute()-&gt;fetchAllAssoc(<span class="string">'nid'</span>);</div></pre></td></tr></table></figure>
<p>##Insert</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$query = \Drupal::database()-&gt;insert(<span class="string">'flood'</span>);</div><div class="line">$query-&gt;fields([</div><div class="line">  <span class="string">'event'</span>,</div><div class="line">  <span class="string">'identifier'</span></div><div class="line">]);</div><div class="line">$query-&gt;values([</div><div class="line">  <span class="string">'My event'</span>,</div><div class="line">  <span class="string">'My indentifier'</span></div><div class="line">]);</div><div class="line">$query-&gt;execute();</div></pre></td></tr></table></figure>
<p>注：values可以调用多次，如<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$query-&gt;values([</div><div class="line">  <span class="string">'My event'</span>,</div><div class="line">  <span class="string">'My indentifier'</span></div><div class="line">])</div><div class="line">-&gt;values([</div><div class="line">  <span class="string">'My event1'</span>,</div><div class="line">  <span class="string">'My indentifier1'</span></div><div class="line">]);</div></pre></td></tr></table></figure></p>
<p>##Update</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$query = \Drupal::database()-&gt;update(<span class="string">'flood'</span>);</div><div class="line">$query-&gt;fields([</div><div class="line">  <span class="string">'identifier'</span> =&gt; <span class="string">'My new identifier'</span></div><div class="line">]);</div><div class="line">$query-&gt;condition(<span class="string">'event'</span>, <span class="string">'My event'</span>);</div><div class="line">$query-&gt;execute();</div></pre></td></tr></table></figure>
<p>##Upsert</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$query = \Drupal::database()-&gt;upsert(<span class="string">'flood'</span>);</div><div class="line">$query-&gt;fields([</div><div class="line">  <span class="string">'fid'</span>,</div><div class="line">  <span class="string">'identifier'</span>,</div><div class="line">]);</div><div class="line">$query-&gt;values([</div><div class="line">  <span class="number">1</span>,</div><div class="line">  <span class="string">'My indentifier for upsert'</span></div><div class="line">]);</div><div class="line">$query-&gt;key(<span class="string">'fid'</span>);</div><div class="line">$query-&gt;execute();</div></pre></td></tr></table></figure>
<p>注：upsert，顾名思义就是update+insert的作用。<br>根据条件判断有无记录，有的话就更新记录，没有的话就插入一条记录。</p>
<p>key()用来定义一个已经存在的row, 必须是unique类型，不然永远执行Insert操作.</p>
<p>###Delete</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$query = \Drupal::database()-&gt;delete(<span class="string">'flood'</span>);</div><div class="line">$query-&gt;condition(<span class="string">'event'</span>, <span class="string">'My event'</span>);</div><div class="line">$query-&gt;execute();</div></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>
    
    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/29/Mysql数据库设计规范/" itemprop="url">
                  MySQL数据库设计规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-06-29T15:51:09+08:00" content="2016-06-29">
              2016-06-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/29/Mysql数据库设计规范/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/29/Mysql数据库设计规范/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>#一、命名规范</p>
<p>###[数据库环境介绍]</p>
<p>通常来讲，各个互联网公司的数据库分为5个数据库环境：</p>
<ol>
<li>dev : 开发环境, 开发可读写,可修改表结构; 常用的163的数据库表; 开发人员可以修改表结构, 可以随意修改其中的数据; 但是需要保证不影响其他开发同事; </li>
<li>qa : 测试环境, 开发可读写, 开发人员可以通过工具修改表结构; </li>
<li>sim: 模拟环境, 开发可读写, 通过web平台;发起上线请求时，会先在这个环境上进行预执行， 这个环境也可供部署上线演练或压力测试使用 可以读写;</li>
<li>real: 生产数据库从库（准实时同步）,只读环境,不允许修改数据,不允许修改表结构; 供线上问题查找,数据查询等使用;</li>
<li>online: 线上环境;开发人员不允许直接在线上环境进行数据库操作,如果需要操作必须找DBA进行操作并进行相应记录;</li>
</ol>
<p>这些环境的机器，一定要做到权限划分明确，读写帐号分离，并且有辨识度，能区分具体业务。例如用户名w_wap, r_wap 能看出来，读写帐号是wap应用的。</p>
<p>###[数据库命名规范]</p>
<ol>
<li>尽量简洁明义，能够一眼看出来这个数据库是用来做什么的；</li>
<li>使用名词作为数据库名称，并且只用英文，不用中文拼音；</li>
<li>使用英文字母，全部小写，控制在3-7个字母以内；</li>
<li>如果有多个单词，则使用下划线隔开，不建义驼峰命名；<br>例如，每个公司都有crm业务，那就叫做xx_crm, 字符集统一utf8。字符集踩过的坑很多，为了通用性统一utf8。<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create database xx_crm default character <span class="built_in">set</span>=utf8;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>###[表命名规范]</p>
<ol>
<li>具备统一前缀，对相关功能的表应当使用相同前缀，如acl_xxx，house_xxx,ppc<em>xxx；其中前缀通常为这个表的模块或依赖主实体对象的名字，通常来讲表名为：业务</em>动作<em>类型，或是业务</em>类型；</li>
<li>表名使用英文小写单词，如果有多个单词则使用下划线隔开；<br>3.表名简介，使用常见单词，避免使用长单词和生僻词；</li>
<li>表引擎取决于实际应用场景及当前数据库中的已经存在的存储引擎；日志及报表类表建议用myisam，与交易，审核，金额相关的表建议用innodb引擎。总体来讲数据库默认innodb；</li>
<li>数据表必须有主键，且建议均使用auto_increment的id作为主键（与业务无关）,和业务相关的要做为唯一索引；</li>
<li>默认使用utf8字符集（由于数据库定义使用了默认，数据表可以不再定义，但为保险起见，建议都写上）；</li>
<li>所有的表都必须有备注，写明白这个表中存放的数据内容；</li>
<li>预估表数据量，如果数据量较大（超过500w）则需要考虑分表策略。可以等量均衡分表或根据业务规则分表均可。要分表的数据表必须与DBA商量分表策略；</li>
<li>职责相近的表，命名规则应该相同；如合同申请，账户信息，交友相关等；<br>举个例子，一张在线冲值记录表：user_bank_deposit 这个就非常符合标准，如果叫做userBankDeposit或是user_chongzhi，就非常不友好。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `house_refresh_log` (</div><div class="line">  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT <span class="string">'自增ID'</span>,</div><div class="line">  `fangid` int(11) NOT NULL COMMENT <span class="string">'房贴子ID'</span>,</div><div class="line">  `refresh_time` int(11) NOT NULL COMMENT <span class="string">'刷新时间'</span>,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  UNIQUE KEY `fangid` (`fangid`)</div><div class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=<span class="string">'房刷新记录表'</span></div></pre></td></tr></table></figure>
<p>###[字段命名规范]</p>
<ol>
<li>数据库字段命名与表名命名类似：</li>
<li>使用小写英文单词，如果有多个单词使用下划线隔开；</li>
<li>使用简单单词，避免生僻词；</li>
<li>字段应当有注释，描述该字段的用途及可能存储的内容，如枚举值则建议将该字段中使用的内容都定义出来；</li>
<li>是别的表的外键均使用xxx_id的方式来表明；</li>
<li>表的主键一般都约定成为id，自增类型；</li>
<li>时间字段，除特殊情况一律采用int来记录unix_timestamp；</li>
<li>网络IP字段，除特殊情况一律用bigint来记录inet_aton值；</li>
<li>所有字段，均为非空，最好显示指定默认值；</li>
<li>有些驱动对tinyint支持不够好，通常建义按容量来选择字段；</li>
<li>text字段尽量少用，或是拆到冗余表中；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `wanted_post` (</div><div class="line">  `id` int(10) NOT NULL AUTO_INCREMENT,</div><div class="line">  `puid` int(10) unsigned NOT NULL,</div><div class="line">  `user_id` int(10) NOT NULL COMMENT <span class="string">'发贴用户的id'</span>,</div><div class="line">  `username` varchar(50) NOT NULL COMMENT <span class="string">'发贴用户的用户名'</span>,</div><div class="line">  `city` smallint(4) NOT NULL COMMENT <span class="string">'所在城市'</span>,</div><div class="line">  `ip` bigint(14) NOT NULL COMMENT <span class="string">'发帖人的ip'</span>,</div><div class="line">  `district_id` tinyint(2) NOT NULL COMMENT <span class="string">'所在区域的id'</span>,</div><div class="line">  `district_name` varchar(20) NOT NULL COMMENT <span class="string">'行政区名字'</span>,</div><div class="line">  `street_id` tinyint(2) NOT NULL COMMENT <span class="string">'所在街道(地标)的id'</span>,</div><div class="line">  `street_name` varchar(20) NOT NULL COMMENT <span class="string">'小区名字'</span>,</div><div class="line">  `title` varchar(255) NOT NULL COMMENT <span class="string">'帖子的标题'</span>,</div><div class="line">  `description` text NOT NULL COMMENT <span class="string">'帖子详情描述'</span>,</div><div class="line">  `post_at` int(11) NOT NULL COMMENT <span class="string">'用户发帖时间,数据创建的时间,使用整型存储'</span>,</div><div class="line">  `refresh_at` int(11) NOT NULL COMMENT <span class="string">'帖子被修改的时间,整型存储'</span>,</div><div class="line">  `show_time` int(11) NOT NULL COMMENT <span class="string">'帖子显示时间'</span>,</div><div class="line">  `age_max` int(11) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'招聘最小年龄'</span>,</div><div class="line">  `age_min` int(11) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'招聘最大年龄'</span>,</div><div class="line">  `post_refresh_at` int(11) NOT NULL COMMENT <span class="string">'刷新时间'</span>,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  UNIQUE KEY `idx_puid` (`puid`),</div><div class="line">  KEY `user_id_index` (`user_id`),</div><div class="line">  KEY `post_at_index` (`post_at`),</div><div class="line">  KEY `refresh_at_index` (`refresh_at`),</div><div class="line">  KEY `show_time_index` (`show_time`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=55295 DEFAULT CHARSET=utf8 COMMENT=<span class="string">'招聘帖子表'</span></div></pre></td></tr></table></figure>
<p>#二、表设计原则</p>
<p>###[职责分离原则]</p>
<p>职责分离原则是指在设计的时候应当考虑到数据的产生，聚合使用等原则，每个系统干自己能干的事情，每个系统只干自己的事情。一个数据表应该放在哪个系统中，通常取决于几点：</p>
<ol>
<li><p>谁产生这个信息：通常情况下谁产生了这个数据应当对此数据负责；也就是考虑该数据的创建，发展，销毁等全生命周期的定义，并将这个定义维护起来提供给消费者作为消费原则；</p>
</li>
<li><p>谁最经常使用这个信息：如果某个系统最经常使用这个数据，最经常去修改某个数据，也应该由该系统来负责保存维护该数据；</p>
</li>
<li><p>遵守高内聚，低耦合的考虑：在存放数据的时候如果考虑到数据使用原则导致了相关度非常高的数据存放在多个地方，需要多个系统来维护这个数据就有可能导致系统间的耦合性增强，应当尽量避免。</p>
</li>
</ol>
<p>在我们设计数据库表间的关系的时候也应当遵守相同原则，职责分离降低耦合，但同时要考虑到性能情况，做到适当冗余而不导致修改逻辑复杂。</p>
<p>举个最常见贴子与评论的例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `wanted_post` (</div><div class="line">  `id` int(10) NOT NULL AUTO_INCREMENT,</div><div class="line">  `puid` int(10) unsigned NOT NULL,</div><div class="line">  `user_id` int(10) NOT NULL COMMENT <span class="string">'发贴用户的id'</span>,</div><div class="line">  `username` varchar(50) NOT NULL COMMENT <span class="string">'发贴用户的用户名'</span>,</div><div class="line">  `city` smallint(4) NOT NULL COMMENT <span class="string">'所在城市'</span>,</div><div class="line">  `ip` bigint(14) NOT NULL COMMENT <span class="string">'发帖人的ip'</span>,</div><div class="line">  `district_id` tinyint(2) NOT NULL COMMENT <span class="string">'所在区域的id'</span>,</div><div class="line">  `district_name` varchar(20) NOT NULL COMMENT <span class="string">'行政区名字'</span>,</div><div class="line">  `street_id` tinyint(2) NOT NULL COMMENT <span class="string">'所在街道(地标)的id'</span>,</div><div class="line">  `street_name` varchar(20) NOT NULL COMMENT <span class="string">'小区名字'</span>,</div><div class="line">  `title` varchar(255) NOT NULL COMMENT <span class="string">'帖子的标题'</span>,</div><div class="line">  `description` text NOT NULL COMMENT <span class="string">'帖子详情描述'</span>,</div><div class="line">  `post_at` int(11) NOT NULL COMMENT <span class="string">'用户发帖时间,数据创建的时间,使用整型存储'</span>,</div><div class="line">  `refresh_at` int(11) NOT NULL COMMENT <span class="string">'帖子被修改的时间,整型存储'</span>,</div><div class="line">  `show_time` int(11) NOT NULL COMMENT <span class="string">'帖子显示时间'</span>,</div><div class="line">  `age_max` int(11) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'招聘最小年龄'</span>,</div><div class="line">  `age_min` int(11) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'招聘最大年龄'</span>,</div><div class="line">  `post_refresh_at` int(11) NOT NULL COMMENT <span class="string">'刷新时间'</span>,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  UNIQUE KEY `idx_puid` (`puid`),</div><div class="line">  KEY `user_id_index` (`user_id`),</div><div class="line">  KEY `post_at_index` (`post_at`),</div><div class="line">  KEY `refresh_at_index` (`refresh_at`),</div><div class="line">  KEY `show_time_index` (`show_time`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=55295 DEFAULT CHARSET=utf8 COMMENT=<span class="string">'招聘帖子表'</span></div><div class="line"></div><div class="line"></div><div class="line">CREATE TABLE `wanted_post_comment_99` (</div><div class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</div><div class="line">  `puid` int(10) unsigned NOT NULL,</div><div class="line">  `user_id` int(10) NOT NULL COMMENT <span class="string">'评论用户ID'</span>,</div><div class="line">  `post_at` int(11) NOT NULL COMMENT <span class="string">'评论时间'</span>,</div><div class="line">  `detail` text NOT NULL COMMENT <span class="string">'评论详情'</span>,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  KEY `user_id_index` (`user_id`),</div><div class="line">  KEY `puidid_index` (`puid`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8 COMMENT=<span class="string">'招聘评论分表99'</span></div></pre></td></tr></table></figure></p>
<p>由于评论表数据量很大，在预先做好分表，按贴子puid分成100张子表，那么当前详情页涉及sql如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">select * from wanted_post <span class="built_in">where</span> puid=xxxx;</div><div class="line">select * from wanted_post_comment_99 <span class="built_in">where</span> puid=xxxx;</div></pre></td></tr></table></figure></p>
<p>这是一个简化的模型，评论多了，还要涉及分页，不可能一次性全取出来。对于上面的场景，严格尊守高内聚，低耦合的原则，不会存储冗余数据。相比较还有一种文档型数据库，例如mongo，就可以将评论与贴子存放在一起，访问的时候只需一次顺序IO操作。整体来讲表设计，要按照职责划分原则。</p>
<p>###[在线处理与分析分离]</p>
<ol>
<li>为了保障线上数据处理的性能，将一些分析相关的数据及分析结果，应当使用单独的库来进行存储，避免在数据分析的时候导致业务数据吞吐量下降，引起系统问题。</li>
<li>专门用于存放离线报表数据，并提供线上数据查询方法，建议将统计结果，汇总的数据都从在线处理数据库中移走。</li>
</ol>
<p>对于上面的wanted_post求职贴子表，在线处理只能是用户在操作：浏览，修改，删除，分别对应如下sql：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">select * from wanted_post <span class="built_in">where</span> puid=xxxxx;</div><div class="line">update wanted_post <span class="built_in">set</span> xxx=xxx <span class="built_in">where</span> puid=xxxx;</div><div class="line">delete from wanted_post <span class="built_in">where</span> puid=xxxx;</div></pre></td></tr></table></figure></p>
<p>同样，对于后台统计来讲，都是些聚合操作，非常消耗性能，例如查看某一用户发贴量：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select count(*) from wanted_post <span class="built_in">where</span> user_id=xxxx;</div></pre></td></tr></table></figure></p>
<p>上面举个通用的例子，原则上要将在线用户请求和后台统计请求分开。简单来讲，对于这种需求处理如下：</p>
<p>将请求指向不同slave ，这种方法简单高效，缺点是数据量增大就玩不转。</p>
<p>建立离线报表库，专门存放统计结果，这样将计算与展示异步处理，缺点是对于实时业务响应不好。</p>
<p>实时拉取mysql row binlog，做数据的异构处理(tungsten, canal)，将增量结果处理后(storm)，保存在数据库中，基本实时。</p>
<p>###[事务与日志分离]</p>
<p>用户生成内容和用户行为日志要分开，这一点很好理解，举两个例子：</p>
<p>游戏DB里存放玩家的基础信息，装备，属性，好友列表等等，这些放到数据库里面。但是玩家的行为日志，比如消耗金币，今天下过哪些副本，买过什么顶级装备，这些属于行为日志，应该单独存放并分析处理。 </p>
<p>对于web用记，有好多用户置顶，刷新，竞价，展示等行为，要求实时并且量很大，一定要和贴子分开。</p>
<p>行为日志，需要做分析处理，并且由于时效性不宜存储在mysql中，后期维护就是地雷。</p>
<p>###[历史可追溯]</p>
<p>在数据库设计的时候为了保障数据是可追溯的，应当遵循一些简单的约定，事后方便数据的查询和统计：</p>
<ol>
<li><p>对于状态数据，应当设计相应状态的字段来保存该数据的最后状态，同时记录下来该数据的初始创建人，时间以及该数据的最后修改人和修改时间；所以在交易数据（如订单合同），广告数据，账户表等都应该默认有状态（status），创建人（creator/creator_name），创建时间（created_at），最后修改人（modifier/modifier_name），最后修改时间（modified_at）等字段用来表明数据的当前状态，创建信息及修改信息。</p>
</li>
<li><p>针对需要跟踪每次修改的数据，需要在数据发生变化的时候记录一张日志表，用于记录该数据发生变化的全生命周期。针对只需要关注关键字段变化的情况，则日志表中只需要记录关键字段变化即可，但操作人，操作类型，时间应当准确记录，日志表数据一旦生成不允许进行修改。如用户账户的充值流水，消费流水都是一些业务紧相关的日志。而审核日志，操作记录等日志则属于与业务关联较小的日志。</p>
</li>
<li><p>针对所有历史需要保留的数据则需要每次变化都生成一个新的版本，比如类目信息等，对原始数据永远只做insert操作，不做delete及update操作。但这种情况仅限于极端数据历史要求极高的情况下使用。</p>
</li>
</ol>

            
          </span>
        
      
    </div>
    
    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://static.verycloud.cn/sites/default/files/pic/image/20150607/2015060790205_41484.jpeg" alt="RamboLau" itemprop="image"/>
          <p class="site-author-name" itemprop="name">RamboLau</p>
        </div>
        <p class="site-description motion-element" itemprop="description">记录生活，分享知识，传播乐趣</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives/">
              <span class="site-state-item-count">79</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories/">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags/">
              <span class="site-state-item-count">65</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/RamboLau" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2012 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RamboLau</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"176code"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
